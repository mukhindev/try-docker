# try-docker

## Dockerfile

Файл `Dockerfile` описывает конфигурацию контейнера

Пример: 

```dockerfile
# На базе Ubuntu
FROM ubuntu:21.04

# Не взаимодействовать с пользователем (установки и сборки без вопросов от Ubuntu)
ARG DEBIAN_FRONTEND=noninteractive

# Временная зона
ENV TZ=Europe/Moscow

# Установка node.js. RUN запускается на этапе сборки контейнера
RUN apt update && apt install -y nodejs && apt install -y npm

# WORKDIR команда cd внутри контейнера при сборке и запуске
WORKDIR /var/www

# Копировать файл index.js в контейнер в /var/www/index.js (в эту дерикторию перешли выше)
COPY ./index.js index.js

# Информация что контейнер использует 3000 порт
EXPOSE 3000

# Вывод версии node и запуск node приложения
CMD node -v && node index.js
```

## Сборка, запуск, остановка

### Сборка `build`

Собрать образ с именем (`-t`, `--tag`).  
Опционально через `:` указывается тег. `name:tag`.  
Далее директория из которой производить сборку

```bash
docker build -t name .
```

### Запуск `run`

Запустить контейнер с указанным именем

```bash
docker run name
```

Запустить контейнер в фоновом режиме (`-d`).  
Вернёт идентификатор запущенного контейнера

```bash
docker run -d name
```

> Ниже про проброс портов и файловой системы

Список запущенных контейнеров

```bash
docker ps
```

### Остановка `stop`

Остановить контейнер с задержкой (`-t 0`) по id.  
Id не обязательно целиком, достаточно уникальную часть

```bash
docker stop -t 0 c9aa05a7f869d
```

## Чёрный ящик

Контейнер — это чёрный ящик. Если мы там запускаем сервер или изменяем файлы,
это внутренние дела контейнера. Более того, при остановке, всё, что происходило в контейнере исчезает.

Что связать с локальной машиной, нужно выполнить проброс портов и файловой системы

```bash
docker run -v ~/dev/try-docker/shared:/var/www/shared -p 4000:3000 -d name
```

Ниже подробнее

### Проброс портов

Документируем нужный порт. `EXPOSE` не открывает порт,
это лишь информация для того кто будет запускать контейнер

```dockerfile
EXPOSE 3000
```

Установка связи портов локальной машины и контейнера при запуске
`-p локальный-порт:порт-контейнера`

```bash
docker run -p 4000:3000 -d name
```

### Проброс файловой системы

`-v абсолютный-локальный-путь:абсолютный-путь-в-контейнере`

```bash
docker run -v ~/dev/try-docker/shared:/var/www/shared -d name 
```
